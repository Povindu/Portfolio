---
import MainLayout from "@/layouts/MainLayout.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import { sanityClient, getProfile } from "@/lib/sanity";
import type { DevProject } from "@/lib/sanity.ts";
import { Icon } from "astro-icon/components";
import { ContactForm } from "@/components/ContactForm";


const query = `*[_type == "devProject"] | order(_createdAt desc) {
  title,
  subtitle,
  slug,
  summary,
  techStack
}`;

const projects = await sanityClient.fetch<DevProject[]>(query);
const profile = await getProfile();
---

<MainLayout
  title={`${profile.fullName} | Software Engineer`}
  description={profile.shortBio}
>
  <header class="mb-16 space-y-6">
    <div
      class={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold tracking-wide uppercase ${
        profile.availability === "available"
          ? "bg-emerald-50 text-emerald-700 dark:bg-emerald-950 dark:text-emerald-300"
          : "bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400"
      }`}
    >
      <span
        class={`w-2 h-2 rounded-full ${
          profile.availability === "available"
            ? "bg-emerald-600 animate-pulse dark:bg-emerald-400"
            : "bg-zinc-500 dark:bg-zinc-400"
        }`}></span>
      {
        profile.availability === "available"
          ? "Available for Hire"
          : "Open to Opportunities"
      }
    </div>

    <h1
      class="text-4xl md:text-6xl font-extrabold tracking-tight text-foreground"
    >
      {profile.headline}
    </h1>

    <p class="text-lg text-muted-foreground max-w-2xl leading-relaxed">
      {profile.shortBio}
    </p>

    <div class="flex gap-4 pt-4">
      <a
        href="#projects"
        class="px-6 py-3 bg-zinc-900 text-white font-medium rounded-lg hover:bg-zinc-800 transition dark:bg-white dark:text-zinc-900 dark:hover:bg-zinc-200"
      >
        View Work
      </a>
      {
        profile.resumeURL && (
          <a
            href={profile.resumeURL}
            target="_blank"
            class="px-6 py-3 border border-zinc-200 text-zinc-700 font-medium rounded-lg hover:bg-zinc-50 transition dark:border-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-800"
          >
            Download CV
          </a>
        )
      }
    </div>
  </header>

  

  <section id="projects" class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
    {projects.map((project) => <ProjectCard project={project} />)}
  </section>

  <section id="contact" class="max-w-5xl mx-auto px-6 py-10">
    <h2 class="text-3xl font-bold text-zinc-900 mb-6 dark:text-white">
      Contact Me
    </h2>
    <p class="text-lg text-zinc-600 dark:text-zinc-400 mb-8">
      Get in touch with me to discuss your next project or collaboration.
    </p>
    <ContactForm client:only="react" /> 
  </section>

</MainLayout>
